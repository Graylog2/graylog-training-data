{
  "v": 1,
  "id": "add0a83f-3b8a-4e9e-8701-0572cdef4e63",
  "rev": 1,
  "name": "Pihole",
  "summary": "Pihole content pack for labs",
  "description": "This content pack is strictly for Graylog labs.",
  "vendor": "Graylog",
  "url": "",
  "parameters": [],
  "entities": [
    {
      "v": "1",
      "type": {
        "name": "dashboard",
        "version": "2"
      },
      "id": "f9ef326e-ad21-4b60-b0b9-530c775c10f7",
      "data": {
        "summary": {
          "@type": "string",
          "@value": "Pihole dashboard"
        },
        "search": {
          "queries": [
            {
              "id": "1908d579-bf8e-40b5-8b37-25cb048f941a",
              "timerange": {
                "range": 0,
                "type": "relative"
              },
              "filters": [],
              "query": {
                "type": "elasticsearch",
                "query_string": ""
              },
              "search_types": [
                {
                  "query": {
                    "type": "elasticsearch",
                    "query_string": "blocked or blacklisted"
                  },
                  "name": "chart",
                  "timerange": {
                    "from": 86400,
                    "type": "relative"
                  },
                  "column_limit": null,
                  "streams": [],
                  "row_limit": null,
                  "series": [
                    {
                      "type": "count",
                      "id": "Message Count",
                      "field": null
                    }
                  ],
                  "filter": null,
                  "rollup": true,
                  "row_groups": [],
                  "type": "pivot",
                  "id": "03f03969-7d8e-4239-bb6a-23cc57dea305",
                  "filters": [],
                  "column_groups": [],
                  "sort": []
                },
                {
                  "query": {
                    "type": "elasticsearch",
                    "query_string": ""
                  },
                  "name": "chart",
                  "timerange": {
                    "from": 86400,
                    "type": "relative"
                  },
                  "column_limit": null,
                  "streams": [],
                  "row_limit": null,
                  "series": [
                    {
                      "type": "count",
                      "id": "count()",
                      "field": null
                    }
                  ],
                  "filter": null,
                  "rollup": true,
                  "row_groups": [
                    {
                      "type": "values",
                      "fields": [
                        "pihole_action"
                      ],
                      "limit": 15
                    }
                  ],
                  "type": "pivot",
                  "id": "eedec729-7f3b-41c1-bf53-73983f68fedc",
                  "filters": [],
                  "column_groups": [],
                  "sort": []
                },
                {
                  "query": {
                    "type": "elasticsearch",
                    "query_string": "blocked OR blacklisted"
                  },
                  "name": "chart",
                  "timerange": {
                    "from": 86400,
                    "type": "relative"
                  },
                  "column_limit": null,
                  "streams": [],
                  "row_limit": null,
                  "series": [
                    {
                      "type": "count",
                      "id": "count()",
                      "field": null
                    }
                  ],
                  "filter": null,
                  "rollup": true,
                  "row_groups": [
                    {
                      "type": "values",
                      "fields": [
                        "http_uri"
                      ],
                      "limit": 15
                    }
                  ],
                  "type": "pivot",
                  "id": "11dd02aa-b9a9-49b2-affd-090b1e794126",
                  "filters": [],
                  "column_groups": [],
                  "sort": []
                },
                {
                  "query": {
                    "type": "elasticsearch",
                    "query_string": "blocked or blacklisted"
                  },
                  "name": "trend",
                  "timerange": {
                    "source": "search_type",
                    "id": "03f03969-7d8e-4239-bb6a-23cc57dea305",
                    "offset": "1i",
                    "type": "offset"
                  },
                  "column_limit": null,
                  "streams": [],
                  "row_limit": null,
                  "series": [
                    {
                      "type": "count",
                      "id": "Message Count",
                      "field": null
                    }
                  ],
                  "filter": null,
                  "rollup": true,
                  "row_groups": [],
                  "type": "pivot",
                  "id": "4991f2e7-220f-4d8e-8ede-8cc363d82384",
                  "filters": [],
                  "column_groups": [],
                  "sort": []
                },
                {
                  "query": {
                    "type": "elasticsearch",
                    "query_string": ""
                  },
                  "name": "chart",
                  "timerange": {
                    "from": 86400,
                    "type": "relative"
                  },
                  "column_limit": null,
                  "streams": [],
                  "row_limit": null,
                  "series": [],
                  "filter": null,
                  "rollup": true,
                  "row_groups": [
                    {
                      "type": "values",
                      "fields": [
                        "dst_ip_geo_location"
                      ],
                      "limit": 15
                    }
                  ],
                  "type": "pivot",
                  "id": "0124a23a-1809-42fa-afc0-be2c78f58870",
                  "filters": [],
                  "column_groups": [],
                  "sort": []
                },
                {
                  "query": {
                    "type": "elasticsearch",
                    "query_string": ""
                  },
                  "name": "chart",
                  "timerange": {
                    "from": 86400,
                    "type": "relative"
                  },
                  "column_limit": null,
                  "streams": [],
                  "row_limit": null,
                  "series": [
                    {
                      "type": "count",
                      "id": "count()",
                      "field": null
                    }
                  ],
                  "filter": null,
                  "rollup": true,
                  "row_groups": [
                    {
                      "type": "values",
                      "fields": [
                        "http_uri"
                      ],
                      "limit": 15
                    }
                  ],
                  "type": "pivot",
                  "id": "eb03fec7-1d8b-4741-ad24-8c1644bd39bc",
                  "filters": [],
                  "column_groups": [],
                  "sort": []
                },
                {
                  "query": {
                    "type": "elasticsearch",
                    "query_string": ""
                  },
                  "name": null,
                  "timerange": {
                    "from": 86400,
                    "type": "relative"
                  },
                  "offset": 0,
                  "streams": [],
                  "filter": null,
                  "decorators": [],
                  "type": "messages",
                  "id": "ad2c9133-1bc7-4ded-8b33-c2e4ff866076",
                  "limit": 150,
                  "filters": []
                },
                {
                  "query": {
                    "type": "elasticsearch",
                    "query_string": ""
                  },
                  "name": "trend",
                  "timerange": {
                    "source": "search_type",
                    "id": "a2a9a1a8-0f61-44a4-b341-e83805ab9c8d",
                    "offset": "1i",
                    "type": "offset"
                  },
                  "column_limit": null,
                  "streams": [],
                  "row_limit": null,
                  "series": [
                    {
                      "type": "count",
                      "id": "Message Count",
                      "field": null
                    }
                  ],
                  "filter": null,
                  "rollup": true,
                  "row_groups": [],
                  "type": "pivot",
                  "id": "fcc89d40-6735-4592-8c7d-f5ab7d3cabe2",
                  "filters": [],
                  "column_groups": [],
                  "sort": []
                },
                {
                  "query": {
                    "type": "elasticsearch",
                    "query_string": ""
                  },
                  "name": "chart",
                  "timerange": {
                    "from": 86400,
                    "type": "relative"
                  },
                  "column_limit": null,
                  "streams": [],
                  "row_limit": null,
                  "series": [
                    {
                      "type": "count",
                      "id": "count()",
                      "field": null
                    }
                  ],
                  "filter": null,
                  "rollup": true,
                  "row_groups": [
                    {
                      "type": "values",
                      "fields": [
                        "query_result"
                      ],
                      "limit": 15
                    }
                  ],
                  "type": "pivot",
                  "id": "338a3129-7057-4bed-8649-8eeb52c8683d",
                  "filters": [],
                  "column_groups": [],
                  "sort": []
                },
                {
                  "query": {
                    "type": "elasticsearch",
                    "query_string": ""
                  },
                  "name": "chart",
                  "timerange": {
                    "from": 86400,
                    "type": "relative"
                  },
                  "column_limit": null,
                  "streams": [],
                  "row_limit": null,
                  "series": [
                    {
                      "type": "count",
                      "id": "Message Count",
                      "field": null
                    }
                  ],
                  "filter": null,
                  "rollup": true,
                  "row_groups": [],
                  "type": "pivot",
                  "id": "a2a9a1a8-0f61-44a4-b341-e83805ab9c8d",
                  "filters": [],
                  "column_groups": [],
                  "sort": []
                }
              ]
            }
          ],
          "parameters": [],
          "requires": {},
          "owner": "admin",
          "created_at": "2023-05-19T18:17:25.027Z"
        },
        "created_at": "2023-05-19T18:06:08.755Z",
        "requires": {},
        "state": {
          "1908d579-bf8e-40b5-8b37-25cb048f941a": {
            "selected_fields": null,
            "static_message_list_id": null,
            "titles": {
              "widget": {
                "5f53dea3-2293-4052-a384-0173d86fe498": "Top Requested URLs",
                "f6b57bd8-a3c0-4da6-bc67-8f8c6b872193": "IP based Geolocation",
                "e1fb8e75-4876-40ea-b50c-b845febb689c": "DNS/Pihole Actions",
                "ee5616a8-871a-4f15-baef-71b9a4554a6e": "Total requests",
                "be5af58b-e9df-4e66-b8f5-ab7abfd301c0": "All Messages",
                "3c5dc130-9fc4-422b-a13f-228f9b1f8e55": "Query result",
                "b33a7872-71fb-4a06-b4dc-9bbfe991574e": "Message Count",
                "88c5c84c-6019-442e-b6f4-220d8abe42b6": "Blackholed requests",
                "8253ac91-dd57-4f43-ab73-47185336f301": "Top blocked URLs"
              }
            },
            "widgets": [
              {
                "id": "3c5dc130-9fc4-422b-a13f-228f9b1f8e55",
                "type": "aggregation",
                "filter": null,
                "filters": [],
                "timerange": {
                  "from": 86400,
                  "type": "relative"
                },
                "query": {
                  "type": "elasticsearch",
                  "query_string": ""
                },
                "streams": [],
                "config": {
                  "visualization": "table",
                  "column_limit": null,
                  "event_annotation": false,
                  "row_limit": 15,
                  "row_pivots": [
                    {
                      "fields": [
                        "query_result"
                      ],
                      "type": "values",
                      "config": {
                        "limit": 15
                      }
                    }
                  ],
                  "series": [
                    {
                      "config": {
                        "name": null
                      },
                      "function": "count()"
                    }
                  ],
                  "rollup": false,
                  "column_pivots": [],
                  "visualization_config": null,
                  "formatting_settings": null,
                  "sort": []
                }
              },
              {
                "id": "ee5616a8-871a-4f15-baef-71b9a4554a6e",
                "type": "aggregation",
                "filter": null,
                "filters": [],
                "timerange": {
                  "from": 86400,
                  "type": "relative"
                },
                "query": {
                  "type": "elasticsearch",
                  "query_string": ""
                },
                "streams": [],
                "config": {
                  "visualization": "numeric",
                  "column_limit": null,
                  "event_annotation": false,
                  "row_limit": null,
                  "row_pivots": [],
                  "series": [
                    {
                      "config": {
                        "name": "Message Count"
                      },
                      "function": "count()"
                    }
                  ],
                  "rollup": false,
                  "column_pivots": [],
                  "visualization_config": {
                    "trend": true,
                    "trend_preference": "HIGHER"
                  },
                  "formatting_settings": null,
                  "sort": []
                }
              },
              {
                "id": "88c5c84c-6019-442e-b6f4-220d8abe42b6",
                "type": "aggregation",
                "filter": null,
                "filters": [],
                "timerange": {
                  "from": 86400,
                  "type": "relative"
                },
                "query": {
                  "type": "elasticsearch",
                  "query_string": "blocked or blacklisted"
                },
                "streams": [],
                "config": {
                  "visualization": "numeric",
                  "column_limit": null,
                  "event_annotation": false,
                  "row_limit": null,
                  "row_pivots": [],
                  "series": [
                    {
                      "config": {
                        "name": "Message Count"
                      },
                      "function": "count()"
                    }
                  ],
                  "rollup": false,
                  "column_pivots": [],
                  "visualization_config": {
                    "trend": true,
                    "trend_preference": "HIGHER"
                  },
                  "formatting_settings": null,
                  "sort": []
                }
              },
              {
                "id": "be5af58b-e9df-4e66-b8f5-ab7abfd301c0",
                "type": "messages",
                "filter": null,
                "filters": [],
                "timerange": {
                  "from": 86400,
                  "type": "relative"
                },
                "query": {
                  "type": "elasticsearch",
                  "query_string": ""
                },
                "streams": [],
                "config": {
                  "fields": [
                    "timestamp",
                    "source"
                  ],
                  "show_message_row": true,
                  "show_summary": true,
                  "decorators": [],
                  "sort": [
                    {
                      "type": "pivot",
                      "field": "timestamp",
                      "direction": "Descending"
                    }
                  ]
                }
              },
              {
                "id": "e1fb8e75-4876-40ea-b50c-b845febb689c",
                "type": "aggregation",
                "filter": null,
                "filters": [],
                "timerange": {
                  "from": 86400,
                  "type": "relative"
                },
                "query": {
                  "type": "elasticsearch",
                  "query_string": ""
                },
                "streams": [],
                "config": {
                  "visualization": "table",
                  "column_limit": null,
                  "event_annotation": false,
                  "row_limit": 15,
                  "row_pivots": [
                    {
                      "fields": [
                        "pihole_action"
                      ],
                      "type": "values",
                      "config": {
                        "limit": 15
                      }
                    }
                  ],
                  "series": [
                    {
                      "config": {
                        "name": null
                      },
                      "function": "count()"
                    }
                  ],
                  "rollup": false,
                  "column_pivots": [],
                  "visualization_config": null,
                  "formatting_settings": null,
                  "sort": []
                }
              },
              {
                "id": "f6b57bd8-a3c0-4da6-bc67-8f8c6b872193",
                "type": "aggregation",
                "filter": null,
                "filters": [],
                "timerange": {
                  "from": 86400,
                  "type": "relative"
                },
                "query": {
                  "type": "elasticsearch",
                  "query_string": ""
                },
                "streams": [],
                "config": {
                  "visualization": "map",
                  "column_limit": null,
                  "event_annotation": false,
                  "row_limit": 15,
                  "row_pivots": [
                    {
                      "fields": [
                        "dst_ip_geo_location"
                      ],
                      "type": "values",
                      "config": {
                        "limit": 15
                      }
                    }
                  ],
                  "series": [],
                  "rollup": false,
                  "column_pivots": [],
                  "visualization_config": {
                    "viewport": {
                      "zoom": 1,
                      "center_x": 0,
                      "center_y": 0
                    }
                  },
                  "formatting_settings": null,
                  "sort": []
                }
              },
              {
                "id": "5f53dea3-2293-4052-a384-0173d86fe498",
                "type": "aggregation",
                "filter": null,
                "filters": [],
                "timerange": {
                  "from": 86400,
                  "type": "relative"
                },
                "query": {
                  "type": "elasticsearch",
                  "query_string": ""
                },
                "streams": [],
                "config": {
                  "visualization": "table",
                  "column_limit": null,
                  "event_annotation": false,
                  "row_limit": 15,
                  "row_pivots": [
                    {
                      "fields": [
                        "http_uri"
                      ],
                      "type": "values",
                      "config": {
                        "limit": 15
                      }
                    }
                  ],
                  "series": [
                    {
                      "config": {
                        "name": null
                      },
                      "function": "count()"
                    }
                  ],
                  "rollup": false,
                  "column_pivots": [],
                  "visualization_config": null,
                  "formatting_settings": null,
                  "sort": []
                }
              },
              {
                "id": "8253ac91-dd57-4f43-ab73-47185336f301",
                "type": "aggregation",
                "filter": null,
                "filters": [],
                "timerange": {
                  "from": 86400,
                  "type": "relative"
                },
                "query": {
                  "type": "elasticsearch",
                  "query_string": "blocked OR blacklisted"
                },
                "streams": [],
                "config": {
                  "visualization": "table",
                  "column_limit": null,
                  "event_annotation": false,
                  "row_limit": 15,
                  "row_pivots": [
                    {
                      "fields": [
                        "http_uri"
                      ],
                      "type": "values",
                      "config": {
                        "limit": 15
                      }
                    }
                  ],
                  "series": [
                    {
                      "config": {
                        "name": null
                      },
                      "function": "count()"
                    }
                  ],
                  "rollup": false,
                  "column_pivots": [],
                  "visualization_config": null,
                  "formatting_settings": null,
                  "sort": []
                }
              }
            ],
            "widget_mapping": {
              "88c5c84c-6019-442e-b6f4-220d8abe42b6": [
                "03f03969-7d8e-4239-bb6a-23cc57dea305",
                "4991f2e7-220f-4d8e-8ede-8cc363d82384"
              ],
              "3c5dc130-9fc4-422b-a13f-228f9b1f8e55": [
                "338a3129-7057-4bed-8649-8eeb52c8683d"
              ],
              "e1fb8e75-4876-40ea-b50c-b845febb689c": [
                "eedec729-7f3b-41c1-bf53-73983f68fedc"
              ],
              "f6b57bd8-a3c0-4da6-bc67-8f8c6b872193": [
                "0124a23a-1809-42fa-afc0-be2c78f58870"
              ],
              "5f53dea3-2293-4052-a384-0173d86fe498": [
                "eb03fec7-1d8b-4741-ad24-8c1644bd39bc"
              ],
              "8253ac91-dd57-4f43-ab73-47185336f301": [
                "11dd02aa-b9a9-49b2-affd-090b1e794126"
              ],
              "be5af58b-e9df-4e66-b8f5-ab7abfd301c0": [
                "ad2c9133-1bc7-4ded-8b33-c2e4ff866076"
              ],
              "ee5616a8-871a-4f15-baef-71b9a4554a6e": [
                "a2a9a1a8-0f61-44a4-b341-e83805ab9c8d",
                "fcc89d40-6735-4592-8c7d-f5ab7d3cabe2"
              ]
            },
            "positions": {
              "3c5dc130-9fc4-422b-a13f-228f9b1f8e55": {
                "col": 10,
                "row": 5,
                "height": 3,
                "width": 3
              },
              "e1fb8e75-4876-40ea-b50c-b845febb689c": {
                "col": 7,
                "row": 5,
                "height": 3,
                "width": 3
              },
              "f6b57bd8-a3c0-4da6-bc67-8f8c6b872193": {
                "col": 1,
                "row": 7,
                "height": 4,
                "width": 6
              },
              "5f53dea3-2293-4052-a384-0173d86fe498": {
                "col": 7,
                "row": 8,
                "height": 3,
                "width": 3
              },
              "8253ac91-dd57-4f43-ab73-47185336f301": {
                "col": 10,
                "row": 8,
                "height": 3,
                "width": 3
              },
              "be5af58b-e9df-4e66-b8f5-ab7abfd301c0": {
                "col": 1,
                "row": 13,
                "height": 6,
                "width": "Infinity"
              },
              "ee5616a8-871a-4f15-baef-71b9a4554a6e": {
                "col": 1,
                "row": 5,
                "height": 2,
                "width": 3
              },
              "88c5c84c-6019-442e-b6f4-220d8abe42b6": {
                "col": 4,
                "row": 5,
                "height": 2,
                "width": 3
              }
            },
            "formatting": {
              "highlighting": []
            },
            "display_mode_settings": {
              "positions": {}
            }
          }
        },
        "properties": [],
        "owner": "admin",
        "title": {
          "@type": "string",
          "@value": "Pihole"
        },
        "type": "DASHBOARD",
        "description": {
          "@type": "string",
          "@value": "This dashboard includes top requested domains, top blocked domains, dns query responses, and an IP geo locationmap."
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.0.5+d61a926"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "515cdeae-3371-461f-8d25-091e7bb68302",
      "data": {
        "title": {
          "@type": "string",
          "@value": "Parse - Pihole - Split pihole message for block or blacklist"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"Parse - Pihole - Split pihole message for block or blacklist\"\nwhen\n    grok (pattern: \"%{NOTSPACE} %{WORD} %{IPORHOST}\",\n         value: to_string($message.message)\n         ).matches == true\nthen\n    let fields = grok(pattern: \"%{NOTSPACE:query_result} %{WORD}}\", \n        value: to_string($message.message),\n        only_named_captures: true);\n    set_fields(fields);\n    set_field(\"parse\", \"parse - Pihole - Split pihole message for block or blacklist\");\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.0.5+d61a926"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "30c7a753-0c94-4163-b717-4d80760dc976",
      "data": {
        "title": {
          "@type": "string",
          "@value": "Enrichment - Pihole - Additional enrichment by extracting iphost info"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"Enrichment - Pihole - Additional enrichment by extracting iphost info\"\n\nwhen\n    grok (pattern: \"%{NOTSPACE} %{WORD} %{IPORHOST}\",\n         value: to_string($message.message)\n         ).matches == true\nthen\n    let fields = grok(pattern: \"%{NOTSPACE:http_uri} %{WORD} %{IPORHOST:IP}\", \n        value: to_string($message.message),\n        only_named_captures: true);\n    set_fields(fields);\n    set_field(\"parse\", \"Additional enrichment by extracting iphost info\");\n    let ip_field = to_string($message.IP);\n    set_field(\"dst_ip\",ip_field);\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.0.5+d61a926"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "b31ac888-1034-4549-8aba-9f2df9c810ca",
      "data": {
        "title": {
          "@type": "string",
          "@value": "Parse - Pihole - Parse dst_ip into destination_ip for GIM"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"Parse - Pihole - Parse dst_ip into destination_ip for GIM\"\nwhen\n    true\nthen\n    let clean_ip = to_ip(to_string($message.dst_ip));\n    set_field(\"destination_ip\", clean_ip);\n    set_field(\"parse\", \"Parse dst_ip into destination_ip for GIM\");\n    remove_field(\"dst_ip\");\n    remove_field(\"IP\");\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.0.5+d61a926"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "5d60ba50-409a-4bfd-a48b-8379f2ec27f8",
      "data": {
        "title": {
          "@type": "string",
          "@value": "Parse - Pihole - Split pihole message into fields"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"Parse - Pihole - Split pihole message into fields\"\nwhen\n    true\nthen\n    let message_field = to_string($message.message);\n    let fields = grok(pattern: \"%{SYSLOGTIMESTAMP:timestamp} %{WORD:application_name}\\\\[%{POSINT:pid}]\\\\: %{NOTSPACE:pihole_action} %{GREEDYDATA:message}\", \n        value: message_field, \n        only_named_captures: true);\n    set_fields(fields);\n    set_field(\"parse\", \"parse - Pihole - Split pihole message into fields\");\n    \n    //Fix the probably incorrect date formatted timestamp to make graylog happy\n    let new_date = flex_parse_date(to_string($message.timestamp));\n    set_field(\"timestamp\", new_date);\n    set_field(\"parse\", \"Parse - Pihole - Split pihole message into fields\");\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.0.5+d61a926"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "3000dba5-5a5a-4386-9d5e-cf65241ea175",
      "data": {
        "title": {
          "@type": "string",
          "@value": "Parse - Pihole - Split pihole message for additional fields"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"Parse - Pihole - Split pihole message for additional fields\"\nwhen\n    grok (pattern: \"%{NOTSPACE} %{WORD} %{NOTSPACE}\",\n         value: to_string($message.message)\n         ).matches == true\nthen\n    let fields = grok(pattern: \"%{NOTSPACE:http_uri} %{WORD} %{NOTSPACE:query_result}\", \n        value: to_string($message.message),\n        only_named_captures: true);\n    set_fields(fields);\n    set_field(\"parse\", \"parse - Pihole - Split pihole message for additional fields\");\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.0.5+d61a926"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "stream",
        "version": "1"
      },
      "id": "995be30e-be9c-4385-a214-541cbdc034ee",
      "data": {
        "alarm_callbacks": [],
        "outputs": [],
        "remove_matches": {
          "@type": "boolean",
          "@value": true
        },
        "title": {
          "@type": "string",
          "@value": "Pihole"
        },
        "stream_rules": [
          {
            "type": {
              "@type": "string",
              "@value": "MATCH_INPUT"
            },
            "field": {
              "@type": "string",
              "@value": ""
            },
            "value": {
              "@type": "string",
              "@value": "64541f0eb90dc40283746e77"
            },
            "inverted": {
              "@type": "boolean",
              "@value": false
            },
            "description": {
              "@type": "string",
              "@value": ""
            }
          }
        ],
        "alert_conditions": [],
        "matching_type": {
          "@type": "string",
          "@value": "AND"
        },
        "disabled": {
          "@type": "boolean",
          "@value": false
        },
        "description": {
          "@type": "string",
          "@value": "All messages pertaining to Pihole are routed to this stream"
        },
        "default_stream": {
          "@type": "boolean",
          "@value": false
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.0.5+d61a926"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "f90d1335-4327-4994-88be-20436946d72f",
      "data": {
        "title": {
          "@type": "string",
          "@value": "GeoIP lookup: dst_ip"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"GeoIP lookup: dst_ip\"\n\nwhen\n    true\nthen\n    let geo = lookup(\"geoip\", to_string($message.dst_ip));\n    set_field(\"dst_ip_geo_location\", geo[\"coordinates\"]);\n    set_field(\"dst_ip_geo_country\", geo[\"country\"].iso_code);\n    set_field(\"dst_ip_geo_city\", geo[\"city\"].names.en);\n    set_field(\"parse\", \"GeoIP lookup: dst_ip\");\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.0.5+d61a926"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "dashboard",
        "version": "2"
      },
      "id": "5c9f05d7-a1d3-49e0-838d-322483b3b331",
      "data": {
        "summary": {
          "@type": "string",
          "@value": "This is a list of all sources that sent in messages to Graylog."
        },
        "search": {
          "queries": [
            {
              "id": "a1647eb6-a064-4fe6-b459-1e4267d3f659",
              "timerange": {
                "range": 300,
                "type": "relative"
              },
              "filters": [],
              "query": {
                "type": "elasticsearch",
                "query_string": ""
              },
              "search_types": [
                {
                  "query": null,
                  "name": "chart",
                  "timerange": {
                    "range": 300,
                    "type": "relative"
                  },
                  "column_limit": null,
                  "streams": [],
                  "row_limit": null,
                  "series": [
                    {
                      "type": "count",
                      "id": "Message count",
                      "field": null
                    }
                  ],
                  "filter": null,
                  "rollup": true,
                  "row_groups": [
                    {
                      "type": "values",
                      "fields": [
                        "source"
                      ],
                      "limit": 15
                    }
                  ],
                  "type": "pivot",
                  "id": "011b2894-49e5-44d8-aab6-8c4d4457a886",
                  "filters": [],
                  "column_groups": [],
                  "sort": [
                    {
                      "type": "series",
                      "field": "count()",
                      "direction": "Descending"
                    }
                  ]
                },
                {
                  "query": null,
                  "name": "chart",
                  "timerange": {
                    "range": 300,
                    "type": "relative"
                  },
                  "column_limit": null,
                  "streams": [],
                  "row_limit": null,
                  "series": [
                    {
                      "type": "count",
                      "id": "Message count",
                      "field": null
                    }
                  ],
                  "filter": null,
                  "rollup": true,
                  "row_groups": [
                    {
                      "type": "values",
                      "fields": [
                        "source"
                      ],
                      "limit": 10
                    }
                  ],
                  "type": "pivot",
                  "id": "a964f1c5-e108-4b5e-a907-ffe0b0f0683c",
                  "filters": [],
                  "column_groups": [],
                  "sort": [
                    {
                      "type": "series",
                      "field": "count()",
                      "direction": "Descending"
                    }
                  ]
                },
                {
                  "query": null,
                  "name": "chart",
                  "timerange": {
                    "range": 300,
                    "type": "relative"
                  },
                  "column_limit": null,
                  "streams": [],
                  "row_limit": null,
                  "series": [
                    {
                      "type": "count",
                      "id": "Message count",
                      "field": null
                    }
                  ],
                  "filter": null,
                  "rollup": true,
                  "row_groups": [
                    {
                      "type": "time",
                      "fields": [
                        "timestamp"
                      ],
                      "interval": {
                        "type": "auto",
                        "scaling": 1
                      }
                    }
                  ],
                  "type": "pivot",
                  "id": "481de18f-938e-40d5-8ab2-6eaf6a28f091",
                  "filters": [],
                  "column_groups": [],
                  "sort": []
                }
              ]
            }
          ],
          "parameters": [],
          "requires": {},
          "owner": "admin",
          "created_at": "2019-11-22T10:58:47.255Z"
        },
        "created_at": "2019-11-22T10:54:50.950Z",
        "requires": {},
        "state": {
          "a1647eb6-a064-4fe6-b459-1e4267d3f659": {
            "selected_fields": null,
            "static_message_list_id": null,
            "titles": {
              "tab": {
                "title": "Sources Overview"
              },
              "widget": {
                "6c127c5d-be75-4157-b43f-ac0194ac0586": "Selected sources",
                "92d63811-e4dd-47db-bd3b-db03c8a9bd53": "Messages per Source",
                "00637e63-d728-4b3e-932b-7c8696b4855d": "Messages over time"
              }
            },
            "widgets": [
              {
                "id": "00637e63-d728-4b3e-932b-7c8696b4855d",
                "type": "aggregation",
                "filter": null,
                "filters": [],
                "timerange": {
                  "range": 300,
                  "type": "relative"
                },
                "query": null,
                "streams": [],
                "config": {
                  "visualization": "line",
                  "column_limit": null,
                  "event_annotation": false,
                  "row_limit": null,
                  "row_pivots": [
                    {
                      "fields": [
                        "timestamp"
                      ],
                      "type": "time",
                      "config": {
                        "interval": {
                          "type": "auto",
                          "scaling": 1
                        }
                      }
                    }
                  ],
                  "series": [
                    {
                      "config": {
                        "name": "Message count"
                      },
                      "function": "count()"
                    }
                  ],
                  "rollup": true,
                  "column_pivots": [],
                  "visualization_config": null,
                  "formatting_settings": null,
                  "sort": []
                }
              },
              {
                "id": "6c127c5d-be75-4157-b43f-ac0194ac0586",
                "type": "aggregation",
                "filter": null,
                "filters": [],
                "timerange": {
                  "range": 300,
                  "type": "relative"
                },
                "query": null,
                "streams": [],
                "config": {
                  "visualization": "table",
                  "column_limit": null,
                  "event_annotation": false,
                  "row_limit": 15,
                  "row_pivots": [
                    {
                      "fields": [
                        "source"
                      ],
                      "type": "values",
                      "config": {
                        "limit": 15
                      }
                    }
                  ],
                  "series": [
                    {
                      "config": {
                        "name": "Message count"
                      },
                      "function": "count()"
                    }
                  ],
                  "rollup": true,
                  "column_pivots": [],
                  "visualization_config": null,
                  "formatting_settings": null,
                  "sort": [
                    {
                      "type": "series",
                      "field": "count()",
                      "direction": "Descending"
                    }
                  ]
                }
              },
              {
                "id": "92d63811-e4dd-47db-bd3b-db03c8a9bd53",
                "type": "aggregation",
                "filter": null,
                "filters": [],
                "timerange": {
                  "range": 300,
                  "type": "relative"
                },
                "query": null,
                "streams": [],
                "config": {
                  "visualization": "pie",
                  "column_limit": null,
                  "event_annotation": false,
                  "row_limit": 10,
                  "row_pivots": [
                    {
                      "fields": [
                        "source"
                      ],
                      "type": "values",
                      "config": {
                        "limit": 10
                      }
                    }
                  ],
                  "series": [
                    {
                      "config": {
                        "name": "Message count"
                      },
                      "function": "count()"
                    }
                  ],
                  "rollup": true,
                  "column_pivots": [],
                  "visualization_config": null,
                  "formatting_settings": null,
                  "sort": [
                    {
                      "type": "series",
                      "field": "count()",
                      "direction": "Descending"
                    }
                  ]
                }
              }
            ],
            "widget_mapping": {
              "6c127c5d-be75-4157-b43f-ac0194ac0586": [
                "011b2894-49e5-44d8-aab6-8c4d4457a886"
              ],
              "92d63811-e4dd-47db-bd3b-db03c8a9bd53": [
                "a964f1c5-e108-4b5e-a907-ffe0b0f0683c"
              ],
              "00637e63-d728-4b3e-932b-7c8696b4855d": [
                "481de18f-938e-40d5-8ab2-6eaf6a28f091"
              ]
            },
            "positions": {
              "6c127c5d-be75-4157-b43f-ac0194ac0586": {
                "col": 1,
                "row": 5,
                "height": 4,
                "width": 6
              },
              "92d63811-e4dd-47db-bd3b-db03c8a9bd53": {
                "col": 7,
                "row": 5,
                "height": 4,
                "width": 6
              },
              "00637e63-d728-4b3e-932b-7c8696b4855d": {
                "col": 1,
                "row": 1,
                "height": 4,
                "width": "Infinity"
              }
            },
            "formatting": {
              "highlighting": []
            },
            "display_mode_settings": {
              "positions": {}
            }
          }
        },
        "properties": [],
        "owner": "admin",
        "title": {
          "@type": "string",
          "@value": "Sources"
        },
        "type": "DASHBOARD",
        "description": {
          "@type": "string",
          "@value": "This is a list of all sources that sent in messages to Graylog. You can narrow the timerange by zooming in on the message histogram, or you can increase the time range by specifying a broader one in the controls at the top. You can also specify filters to limit the results you are seeing. You can also add additional widgets to this dashboard, or adapt the appearance of existing widgets to suit your needs."
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.0.5+d61a926"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "b02a67c3-f54b-4aa3-9063-ca5de2b13e78",
      "data": {
        "title": {
          "@type": "string",
          "@value": "GreyNoise Lookup rule for destination_ip"
        },
        "description": {
          "@type": "string",
          "@value": "This rule uses the Greynoise lookup table to retrieve values and then set them as fields with a specific prefix."
        },
        "source": {
          "@type": "string",
          "@value": "rule \"GreyNoise Lookup rule for destination_ip\"\nwhen\n    true\nthen\n    let custom_lookupdata = lookup(\n        lookup_table: \"greynoise\",\n        key: to_string($message.destination_ip)\n        );\n    set_fields(\n        fields: custom_lookupdata,\n        prefix: \"greynoise_\"\n        );\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.0.5+d61a926"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "cd8832b7-d5e3-4fa4-a9a4-d32f9f9c0940",
      "data": {
        "title": {
          "@type": "string",
          "@value": "Context - Pihole - gravity tracking"
        },
        "description": {
          "@type": "string",
          "@value": ""
        },
        "source": {
          "@type": "string",
          "@value": "rule \"Context - Pihole - gravity tracking\"\nwhen\n    $message.pihole_action == \"gravity\"\nthen\n    set_field(\"parse\", \"Context - Pihole - gravity tracking\");\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.0.5+d61a926"
        }
      ]
    },
    {
      "v": "1",
      "type": {
        "name": "pipeline_rule",
        "version": "1"
      },
      "id": "d1e131e1-3b4a-4000-904c-96ab7980d2d7",
      "data": {
        "title": {
          "@type": "string",
          "@value": "Parse - Pihole - Set pihole_action field to empty"
        },
        "description": {
          "@type": "string",
          "@value": "This is a special edge case when the message field contains \"only locally-known addresses for localhost.\" If we do not account for this edge case, the pihole_action field is filled with trash."
        },
        "source": {
          "@type": "string",
          "@value": "rule \"Parse - Pihole - Set pihole_action field to empty\"\nwhen\n    has_field(\"message\") && contains(to_string($message.message), \n    \"only locally-known addresses for localhost\")\nthen\n    set_field(\"pihole_action\", \"\");\n    set_field(\"parse\", \"parse - Pihole - Set pihole_action field to empty\");\nend"
        }
      },
      "constraints": [
        {
          "type": "server-version",
          "version": ">=5.0.5+d61a926"
        }
      ]
    }
  ]
}