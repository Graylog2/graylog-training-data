{"id":"57314705-2c47-4db3-a357-6d3fe99e8f2e","rev":2,"v":"1","name":"solve-pipelines_parsing_gim-Okay_lets_actually_use_a_pipeline_to_add_data","summary":"solve-pipelines_parsing_gim-Okay_lets_actually_use_a_pipeline_to_add_data","description":"","vendor":"Graylog Service Delivery","url":"","created_at":"2024-03-19T21:19:22.338Z","server_version":"5.2.5+7eaa89d","parameters":[],"entities":[{"id":"5200a40f-6c7a-4486-8e09-525428d815d8","type":{"name":"pipeline","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Routing"},"description":{"@type":"string","@value":"Route the logs!"},"source":{"@type":"string","@value":"pipeline \"Routing\"\nstage 0 match either\nrule \"Route - My First Stream Logs\"\nrule \"Route - Desktop Firewall - MS Logs\"\nend"},"connected_streams":[{"@type":"string","@value":"1d6a78c2-fa78-451b-a6e8-5a0d864159f5"}]},"constraints":[{"type":"server-version","version":">=5.2.5+7eaa89d"}]},{"id":"73ad797a-f53d-4ab7-b451-47199041a9f0","type":{"name":"pipeline","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Training"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"pipeline \"Training\"\nstage 0 match either\nrule \"Route - Training\"\nstage 75 match either\nstage 50 match either\nrule \"Parse - UTM-KV\"\nrule \"Parse - Apache\"\nrule \"Context - Always True\"\nend"},"connected_streams":[{"@type":"string","@value":"1d6a78c2-fa78-451b-a6e8-5a0d864159f5"}]},"constraints":[{"type":"server-version","version":">=5.2.5+7eaa89d"}]},{"id":"a0ca06b3-1f2a-4efd-b530-a984c64051f3","type":{"name":"pipeline_rule","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Context - Always True"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"rule \"Context - Always True\"\nwhen\n  true\nthen\n  set_field(\n    field : \"rule_demo\",\n    value : \"With great power comes great responsibility\",\n    clean_field : false\n  );\nend"}},"constraints":[{"type":"server-version","version":">=5.2.5+7eaa89d"}]},{"id":"88944c9b-14c5-40d7-8d73-36a39476db91","type":{"name":"pipeline_rule","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Route - Training"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"rule \"Route - Training\"\nwhen\n    has_field(\"log_pack\")\nthen\n    route_to_stream(\n        name: \"Training Logs\"\n        );\nend"}},"constraints":[{"type":"server-version","version":">=5.2.5+7eaa89d"}]},{"id":"24bf2051-e0ef-4e04-8496-f4e22faab91f","type":{"name":"pipeline_rule","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Parse - Apache"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"rule \"Parse - Apache\"\nwhen\n    has_field(\"log_pack\") &&\n    to_string($message.log_pack) == \"002-gl.json\"\nthen\n let parsegrok = grok(\n        pattern: \"%{COMBINEDAPACHELOG}\",\n        value: to_string($message.message), \n        only_named_captures: true\n        ); \n set_fields(parsegrok); \n    set_field(\n        field: \"parser\", \n        value: \"apache_grok\"\n    );\nset_field(\n    field: \"timestamp\",\n    value: now()\n    );\nset_field(\n    field: \"cluster_node\",\n    value: to_string($message.filebeat_host_name)\n    );\n    remove_field(\"filebeat_@timestamp\");\n    remove_field(\"filebeat_@timestamp\");\n    remove_field(\"filebeat_@metadata_beat\");\nremove_field(\"filebeat_@metadata_pipeline\");\nremove_field(\"filebeat_@metadata_type\");\nremove_field(\"filebeat_@metadata_version\");\nremove_field(\"filebeat_@timestamp\");\nremove_field(\"filebeat_agent_ephemeral_id\");\nremove_field(\"filebeat_agent_hostname\");\nremove_field(\"filebeat_agent_id\");\nremove_field(\"filebeat_agent_name\");\nremove_field(\"filebeat_agent_type\");\nremove_field(\"filebeat_agent_version\");\nremove_field(\"filebeat_ecs_version\");\nremove_field(\"filebeat_event_dataset\");\nremove_field(\"filebeat_event_module\");\nremove_field(\"filebeat_fileset_name\");\nremove_field(\"filebeat_host_architecture\");\nremove_field(\"filebeat_host_hostname\");\nremove_field(\"filebeat_host_id\");\n    \n    \nend\n"}},"constraints":[{"type":"server-version","version":">=5.2.5+7eaa89d"}]},{"id":"296bc72a-8ab7-4016-970e-c2ec59246c96","type":{"name":"pipeline_rule","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Parse - UTM-KV"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"rule \"Parse - UTM-KV\"\nwhen\n    to_string($message.log_category) == \"UTM\"\nthen\n    let parsekv = key_value(\n        value: to_string($message.message),\n        trim_value_chars: '\"', \n        ignore_empty_values: true\n        );\n    set_fields(parsekv);\n    set_field(\n        field: \"parser\", \n        value: \"Parse - UTM-KV\"\n    );\nend\n"}},"constraints":[{"type":"server-version","version":">=5.2.5+7eaa89d"}]},{"id":"28c67cdd-9d25-45cb-aca8-cd8fc55be07d","type":{"name":"pipeline_rule","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Route - Desktop Firewall - MS Logs"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"rule \"Route - Desktop Firewall - MS Logs\"\nwhen\n    from_input(\n        name: \"MS Logs\")\nthen\n    route_to_stream(\n        name: \"Desktop Firewall Events\",\n        remove_from_default: true\n    );\n\n    set_field(\n        field: \"route\",\n        value: \"Desktop Firewall - MS Logs\",\n        prefix: \"corpNet_\"\n    );\nend"}},"constraints":[{"type":"server-version","version":">=5.2.5+7eaa89d"}]},{"id":"20920092-e4a6-45b6-99a6-d91a31ea52f1","type":{"name":"pipeline_rule","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Route - My First Stream Logs"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"rule \"Route - My First Stream Logs\"\nwhen\n  from_input(\n    id : \"65f9f460d5e8272330e7c18a\"\n  )\nthen\n  route_to_stream(\n    name : \"My First Stream\",\n    remove_from_default : true\n  );\nend"}},"constraints":[{"type":"server-version","version":">=5.2.5+7eaa89d"}]},{"id":"f1bce23f-a4bc-4ac3-972b-f5570d0dd7a0","type":{"name":"pipeline_rule","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Parse - UTM-KV"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"rule \"Parse - UTM-KV\"\nwhen\n    to_string($message.log_category) == \"UTM\"\nthen\n    let parsekv = key_value(\n        value: to_string($message.message),\n        trim_value_chars: '\"', \n        ignore_empty_values: true\n        );\n    set_fields(parsekv);\n    set_field(\n        field: \"parser\", \n        value: \"Parse - UTM-KV\"\n    );\nend\n"}},"constraints":[{"type":"server-version","version":">=5.2.5+7eaa89d"}]},{"id":"e72dc7ee-ba6f-41f9-9e75-5d2667e5cb72","type":{"name":"pipeline_rule","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Context - Always True"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"rule \"Context - Always True\"\nwhen\n  true\nthen\n  set_field(\n    field : \"rule_demo\",\n    value : \"With great power comes great responsibility\",\n    clean_field : false\n  );\nend"}},"constraints":[{"type":"server-version","version":">=5.2.5+7eaa89d"}]},{"id":"aa030e55-bdc7-40b0-ba24-f51b524b38ad","type":{"name":"pipeline_rule","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Route - Training"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"rule \"Route - Training\"\nwhen\n    has_field(\"log_pack\")\nthen\n    route_to_stream(\n        name: \"Training Logs\"\n        );\nend"}},"constraints":[{"type":"server-version","version":">=5.2.5+7eaa89d"}]},{"id":"8c224ebf-ab52-4527-804a-45ef1a438cf6","type":{"name":"pipeline_rule","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Parse - Apache"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"rule \"Parse - Apache\"\nwhen\n    has_field(\"log_pack\") &&\n    to_string($message.log_pack) == \"002-gl.json\"\nthen\n let parsegrok = grok(\n        pattern: \"%{COMBINEDAPACHELOG}\",\n        value: to_string($message.message), \n        only_named_captures: true\n        ); \n set_fields(parsegrok); \n    set_field(\n        field: \"parser\", \n        value: \"apache_grok\"\n    );\nset_field(\n    field: \"timestamp\",\n    value: now()\n    );\nset_field(\n    field: \"cluster_node\",\n    value: to_string($message.filebeat_host_name)\n    );\n    remove_field(\"filebeat_@timestamp\");\n    remove_field(\"filebeat_@timestamp\");\n    remove_field(\"filebeat_@metadata_beat\");\nremove_field(\"filebeat_@metadata_pipeline\");\nremove_field(\"filebeat_@metadata_type\");\nremove_field(\"filebeat_@metadata_version\");\nremove_field(\"filebeat_@timestamp\");\nremove_field(\"filebeat_agent_ephemeral_id\");\nremove_field(\"filebeat_agent_hostname\");\nremove_field(\"filebeat_agent_id\");\nremove_field(\"filebeat_agent_name\");\nremove_field(\"filebeat_agent_type\");\nremove_field(\"filebeat_agent_version\");\nremove_field(\"filebeat_ecs_version\");\nremove_field(\"filebeat_event_dataset\");\nremove_field(\"filebeat_event_module\");\nremove_field(\"filebeat_fileset_name\");\nremove_field(\"filebeat_host_architecture\");\nremove_field(\"filebeat_host_hostname\");\nremove_field(\"filebeat_host_id\");\n    \n    \nend\n"}},"constraints":[{"type":"server-version","version":">=5.2.5+7eaa89d"}]},{"id":"82fcc9bc-aecc-44f2-9fdf-9b7ab98df31d","type":{"name":"stream","version":"1"},"v":"1","data":{"alarm_callbacks":[],"outputs":[],"remove_matches":{"@type":"boolean","@value":false},"title":{"@type":"string","@value":"Desktop Firewall Events"},"stream_rules":[],"alert_conditions":[],"matching_type":{"@type":"string","@value":"AND"},"disabled":{"@type":"boolean","@value":false},"description":{"@type":"string","@value":"Desktop Firewall Events"},"default_stream":{"@type":"boolean","@value":false}},"constraints":[{"type":"server-version","version":">=5.2.5+7eaa89d"}]},{"id":"5eddbfd9-82cb-497f-a244-fac02bdfd28a","type":{"name":"stream_title","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Default Stream"}},"constraints":[{"type":"server-version","version":">=5.2.5+7eaa89d"}]},{"id":"1d6a78c2-fa78-451b-a6e8-5a0d864159f5","type":{"name":"stream_title","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Default Stream"}},"constraints":[{"type":"server-version","version":">=5.2.5+7eaa89d"}]}]}