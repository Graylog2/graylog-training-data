{"id":"57314705-2c47-4db3-a357-6d3fe99e8f2e","rev":3,"v":"1","name":"solve-pipelines_parsing_gim-Okay_lets_actually_use_a_pipeline_to_add_data","summary":"solve-pipelines_parsing_gim-Okay_lets_actually_use_a_pipeline_to_add_data","description":"","vendor":"Graylog Service Delivery","url":"","created_at":"2024-04-05T20:34:40.417Z","server_version":"6.0.0-rc.1+61d7f40","parameters":[],"entities":[{"id":"10fc0e04-e5f8-4f32-84af-13836c788ad6","type":{"name":"pipeline","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Routing"},"description":{"@type":"string","@value":"Route the logs!"},"source":{"@type":"string","@value":"pipeline \"Routing\"\nstage 0 match either\nrule \"Route - My First Stream Logs\"\nrule \"Route - Desktop Firewall - MS Logs\"\nend"},"connected_streams":[{"@type":"string","@value":"f63303b6-f9df-4501-a501-f505fd56fbfe"}]},"constraints":[{"type":"server-version","version":">=6.0.0-rc.1+61d7f40"}]},{"id":"ddecbd5f-8b33-4ec6-9d8d-2be36b0f380d","type":{"name":"pipeline","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Training"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"pipeline \"Training\"\nstage 0 match either\nrule \"Route - Training\"\nstage 75 match either\nstage 50 match either\nrule \"Parse - UTM-KV\"\nrule \"Parse - Apache\"\nrule \"Context - Always True\"\nend"},"connected_streams":[{"@type":"string","@value":"f63303b6-f9df-4501-a501-f505fd56fbfe"}]},"constraints":[{"type":"server-version","version":">=6.0.0-rc.1+61d7f40"}]},{"id":"a90aee50-ea91-4b18-aa32-dc6f29b5ad93","type":{"name":"pipeline_rule","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Route - Desktop Firewall - MS Logs"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"rule \"Route - Desktop Firewall - MS Logs\"\nwhen\n    from_input(\n        name: \"MS Logs\")\nthen\n    route_to_stream(\n        name: \"Desktop Firewall Events\",\n        remove_from_default: true\n    );\n\n    set_field(\n        field: \"route\",\n        value: \"Desktop Firewall - MS Logs\"\n    );\nend"}},"constraints":[{"type":"server-version","version":">=6.0.0-rc.1+61d7f40"}]},{"id":"5323b175-f52a-4d42-baac-1f83c71f1451","type":{"name":"pipeline_rule","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Route - My First Stream Logs"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"rule \"Route - My First Stream Logs\"\nwhen\n  from_input(\n    id : \"661047a0a480e766cfcd0edb\"\n  )\nthen\n  route_to_stream(\n    name : \"My First Stream\",\n    remove_from_default : true\n  );\nend"}},"constraints":[{"type":"server-version","version":">=6.0.0-rc.1+61d7f40"}]},{"id":"82bd8e4f-26e4-42e6-bf70-64903ee03a1f","type":{"name":"pipeline_rule","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Parse - UTM-KV"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"rule \"Parse - UTM-KV\"\nwhen\n    to_string($message.log_category) == \"UTM\"\nthen\n    let parsekv = key_value(\n        value: to_string($message.message),\n        trim_value_chars: '\"', \n        ignore_empty_values: true\n        );\n    set_fields(parsekv);\n    set_field(\n        field: \"parser\", \n        value: \"Parse - UTM-KV\"\n    );\nend\n"}},"constraints":[{"type":"server-version","version":">=6.0.0-rc.1+61d7f40"}]},{"id":"32b2ea0d-6608-4f21-8cf5-f9e149d05855","type":{"name":"pipeline_rule","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Route - Training"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"rule \"Route - Training\"\nwhen\n    has_field(\"log_pack\")\nthen\n    route_to_stream(\n        name: \"Training Logs\"\n        );\nend"}},"constraints":[{"type":"server-version","version":">=6.0.0-rc.1+61d7f40"}]},{"id":"a407b1b2-b5ed-41cd-8bf3-2452c54aa46a","type":{"name":"pipeline_rule","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Parse - Apache"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"rule \"Parse - Apache\"\nwhen\n    has_field(\"log_pack\") &&\n    to_string($message.log_pack) == \"002-gl.json\"\nthen\n let parsegrok = grok(\n        pattern: \"%{COMBINEDAPACHELOG}\",\n        value: to_string($message.message), \n        only_named_captures: true\n        ); \n set_fields(parsegrok); \n    set_field(\n        field: \"parser\", \n        value: \"apache_grok\"\n    );\nset_field(\n    field: \"timestamp\",\n    value: now()\n    );\nset_field(\n    field: \"cluster_node\",\n    value: to_string($message.filebeat_host_name)\n    );\n    remove_field(\"filebeat_@timestamp\");\n    remove_field(\"filebeat_@timestamp\");\n    remove_field(\"filebeat_@metadata_beat\");\nremove_field(\"filebeat_@metadata_pipeline\");\nremove_field(\"filebeat_@metadata_type\");\nremove_field(\"filebeat_@metadata_version\");\nremove_field(\"filebeat_@timestamp\");\nremove_field(\"filebeat_agent_ephemeral_id\");\nremove_field(\"filebeat_agent_hostname\");\nremove_field(\"filebeat_agent_id\");\nremove_field(\"filebeat_agent_name\");\nremove_field(\"filebeat_agent_type\");\nremove_field(\"filebeat_agent_version\");\nremove_field(\"filebeat_ecs_version\");\nremove_field(\"filebeat_event_dataset\");\nremove_field(\"filebeat_event_module\");\nremove_field(\"filebeat_fileset_name\");\nremove_field(\"filebeat_host_architecture\");\nremove_field(\"filebeat_host_hostname\");\nremove_field(\"filebeat_host_id\");\n    \n    \nend\n"}},"constraints":[{"type":"server-version","version":">=6.0.0-rc.1+61d7f40"}]},{"id":"bed9c82b-3f78-49ac-8c9b-eb048bd4abfa","type":{"name":"pipeline_rule","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Context - Always True"},"description":{"@type":"string","@value":""},"source":{"@type":"string","@value":"rule \"Context - Always True\"\nwhen\n  true\nthen\n  set_field(\n    field : \"rule_demo\",\n    value : \"With great power comes great responsibility\",\n    clean_field : false\n  );\nend"}},"constraints":[{"type":"server-version","version":">=6.0.0-rc.1+61d7f40"}]},{"id":"657cc8c3-8ea7-4d39-b870-2a3c15157dfc","type":{"name":"stream","version":"1"},"v":"1","data":{"alarm_callbacks":[],"outputs":[],"remove_matches":{"@type":"boolean","@value":false},"title":{"@type":"string","@value":"Desktop Firewall Events"},"stream_rules":[],"alert_conditions":[],"matching_type":{"@type":"string","@value":"AND"},"disabled":{"@type":"boolean","@value":false},"description":{"@type":"string","@value":"Desktop Firewall Events"},"default_stream":{"@type":"boolean","@value":false}},"constraints":[{"type":"server-version","version":">=6.0.0-rc.1+61d7f40"}]},{"id":"f63303b6-f9df-4501-a501-f505fd56fbfe","type":{"name":"stream_title","version":"1"},"v":"1","data":{"title":{"@type":"string","@value":"Default Stream"}},"constraints":[{"type":"server-version","version":">=6.0.0-rc.1+61d7f40"}]}]}